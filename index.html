<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ECHO DROP v1.0</title>
<link rel="icon" href="logo.png" />
<style>
  :root {
    --page-bg: #0f0f0f;
    --canvas-border: #222;
    --accent: #a9ddd3;
  }
  body {
    background: var(--page-bg);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    color: #fff;
    font-family: 'Courier New', monospace;
    overflow: hidden;
  }
  h1 {
    margin-bottom: 10px;
    letter-spacing: 2px;
    color: var(--accent);
  }
  #canvas {
    border: 3px solid var(--canvas-border);
    background: #111;
    box-shadow: 0 0 20px rgba(169,221,211,0.2);
  }
  #scoreboard {
    margin-top: 10px;
    text-align: center;
    font-size: 18px;
  }
  #leaderboard {
    margin-top: 15px;
    font-size: 14px;
    color: #aaa;
  }
</style>
</head>
<body>
  <h1>ECHO DROP</h1>
  <canvas id="canvas" width="400" height="600"></canvas>
  <div id="scoreboard">Score: <span id="score">0</span></div>
  <div id="leaderboard"><b>Top Scores</b><br><ul id="scoresList"></ul></div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const scoreDisplay = document.getElementById('score');
const scoresList = document.getElementById('scoresList');

let player = { x: 180, y: 550, size: 40, color: '#a9ddd3' };
let blocks = [];
let score = 0;
let gameOver = false;

// === SOUND SETUP ===
const sounds = {
  left: new Audio('https://cdn.jsdelivr.net/gh/jshawl/tones/tones/triangle/c4.mp3'),
  mid: new Audio('https://cdn.jsdelivr.net/gh/jshawl/tones/tones/triangle/e4.mp3'),
  right: new Audio('https://cdn.jsdelivr.net/gh/jshawl/tones/tones/triangle/g4.mp3'),
  hit: new Audio('https://cdn.jsdelivr.net/gh/jshawl/tones/tones/sine/b4.mp3')
};
function playSound(pos) {
  const s = pos === 'left' ? sounds.left : pos === 'right' ? sounds.right : sounds.mid;
  s.currentTime = 0;
  s.play();
}

// === BLOCK GENERATOR ===
function spawnBlock() {
  const size = 40;
  const x = Math.random() * (canvas.width - size);
  const speed = 2 + Math.random() * 3;
  const hue = Math.floor(Math.random() * 360);
  const gradient = ctx.createLinearGradient(x, 0, x + size, size);
  gradient.addColorStop(0, `hsl(${hue}, 90%, 60%)`);
  gradient.addColorStop(1, `hsl(${(hue + 60) % 360}, 90%, 40%)`);
  const soundPos = x < canvas.width/3 ? 'left' : x > (2*canvas.width/3) ? 'right' : 'mid';
  playSound(soundPos);
  blocks.push({ x, y: -size, size, speed, gradient });
}

// === GAME LOOP ===
function drawPlayer() {
  ctx.fillStyle = player.color;
  ctx.fillRect(player.x, player.y, player.size, player.size);
}
function drawBlocks() {
  blocks.forEach(b => {
    ctx.fillStyle = b.gradient;
    ctx.fillRect(b.x, b.y, b.size, b.size);
  });
}
function updateBlocks() {
  for (let i = blocks.length - 1; i >= 0; i--) {
    blocks[i].y += blocks[i].speed;
    if (blocks[i].y > canvas.height) blocks.splice(i, 1);
  }
}
function checkCollision() {
  blocks.forEach((b, i) => {
    if (b.x < player.x + player.size &&
        b.x + b.size > player.x &&
        b.y < player.y + player.size &&
        b.y + b.size > player.y) {
      sounds.hit.play();
      gameOver = true;
    }
  });
}
function loop() {
  if (gameOver) {
    ctx.fillStyle = 'rgba(0,0,0,0.7)';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = '#fff';
    ctx.font = '28px monospace';
    ctx.fillText('GAME OVER', 120, 300);
    saveScore(score);
    return;
  }
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawPlayer();
  drawBlocks();
  updateBlocks();
  checkCollision();
  score++;
  scoreDisplay.textContent = score;
  requestAnimationFrame(loop);
}

// === CONTROL ===
document.addEventListener('keydown', e => {
  if (e.key === 'ArrowLeft' && player.x > 0) player.x -= 40;
  if (e.key === 'ArrowRight' && player.x < canvas.width - player.size) player.x += 40;
});

// === LEADERBOARD ===
function saveScore(s) {
  const saved = JSON.parse(localStorage.getItem('echoScores') || '[]');
  saved.push(s);
  saved.sort((a,b)=>b-a);
  const top5 = saved.slice(0,5);
  localStorage.setItem('echoScores', JSON.stringify(top5));
  renderLeaderboard(top5);
}
function renderLeaderboard(list) {
  scoresList.innerHTML = '';
  list.forEach((s,i)=>{
    const li = document.createElement('li');
    li.textContent = `#${i+1}: ${s}`;
    scoresList.appendChild(li);
  });
}
renderLeaderboard(JSON.parse(localStorage.getItem('echoScores') || '[]'));

// === LOOP SPAWN ===
setInterval(spawnBlock, 800);
loop();
</script>
</body>
</html>
