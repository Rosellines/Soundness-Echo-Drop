<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rialo Drop</title>
<link rel="icon" href="logo.png" />
<style>
  :root {
    --page-bg: #e8e3d5;
    --canvas-border: #010101;
    --accent: #a9ddd3;
    --text-dark: #222;
  }
  body {
    margin: 0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: var(--page-bg);
    font-family: monospace;
    color: var(--text-dark);
  }
  .container {
    display: flex;
    gap: 40px;
    align-items: flex-start;
  }
  #game {
    border: 4px solid var(--canvas-border);
    background: #f4f2ec;
    image-rendering: pixelated;
  }
  #sidebar {
    display: flex;
    flex-direction: column;
    gap: 16px;
    background: #ffffff90;
    padding: 12px 20px;
    border-radius: 12px;
    box-shadow: 0 0 10px #00000022;
  }
  h2 {
    margin: 0;
    font-size: 20px;
    text-align: center;
  }
  ul {
    padding: 0;
    list-style: none;
    margin: 0;
  }
  li {
    margin: 4px 0;
  }
</style>
</head>
<body>
  <div class="container">
    <canvas id="game" width="360" height="720"></canvas>
    <div id="sidebar">
      <h2>üèÜ Leaderboard</h2>
      <ul id="leaderboard"></ul>
      <div id="scoreDisplay">Score: 0</div>
    </div>
  </div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const COLS = 10, ROWS = 20, SCALE = 36;
ctx.scale(SCALE, SCALE);

let board = Array.from({ length: ROWS }, () => Array(COLS).fill(0));
let score = 0;
let dropCounter = 0;
let lastTime = 0;

const player = {
  pos: { x: 4, y: 0 },
  matrix: [[1,1,1],[0,1,0]], // simple piece
};

function drawMatrix(matrix, offset) {
  matrix.forEach((row, y) => {
    row.forEach((value, x) => {
      if (value !== 0) {
        ctx.fillStyle = "#444";
        ctx.fillRect(x + offset.x, y + offset.y, 1, 1);
      }
    });
  });
}

function drawBoard() {
  board.forEach((row, y) => {
    row.forEach((value, x) => {
      if (value !== 0) {
        ctx.fillStyle = "#999";
        ctx.fillRect(x, y, 1, 1);
      }
    });
  });
}

function draw() {
  ctx.fillStyle = "#f4f2ec";
  ctx.fillRect(0, 0, COLS, ROWS);
  drawBoard();
  drawMatrix(player.matrix, player.pos);
}

function merge(board, player) {
  player.matrix.forEach((row, y) => {
    row.forEach((value, x) => {
      if (value !== 0) {
        board[y + player.pos.y][x + player.pos.x] = value;
      }
    });
  });
}

function collide(board, player) {
  const [m, o] = [player.matrix, player.pos];
  for (let y = 0; y < m.length; ++y) {
    for (let x = 0; x < m[y].length; ++x) {
      if (m[y][x] !== 0 &&
        (board[y + o.y] && board[y + o.y][x + o.x]) !== 0) {
        return true;
      }
    }
  }
  return false;
}

function resetPlayer() {
  player.matrix = [[1,1,1],[0,1,0]];
  player.pos.y = 0;
  player.pos.x = 4;
  if (collide(board, player)) {
    storeScore(score);
    score = 0;
    board.forEach(row => row.fill(0));
  }
}

function drop() {
  player.pos.y++;
  if (collide(board, player)) {
    player.pos.y--;
    merge(board, player);
    resetPlayer();
  }
  dropCounter = 0;
}

function update(time = 0) {
  const deltaTime = time - lastTime;
  lastTime = time;
  dropCounter += deltaTime;
  if (dropCounter > 1000) drop();
  draw();
  document.getElementById("scoreDisplay").textContent = `Score: ${score}`;
  requestAnimationFrame(update);
}

document.addEventListener("keydown", e => {
  if (e.key === "ArrowLeft") player.pos.x--;
  else if (e.key === "ArrowRight") player.pos.x++;
  else if (e.key === "ArrowDown") drop();
});

function storeScore(newScore) {
  let scores = JSON.parse(localStorage.getItem("rialo_scores") || "[]");
  scores.push(newScore);
  scores.sort((a, b) => b - a);
  scores = scores.slice(0, 5);
  localStorage.setItem("rialo_scores", JSON.stringify(scores));
  renderLeaderboard();
}

function renderLeaderboard() {
  const lb = document.getElementById("leaderboard");
  const scores = JSON.parse(localStorage.getItem("rialo_scores") || "[]");
  lb.innerHTML = scores.length
    ? scores.map((s, i) => `<li>${i + 1}. ${s}</li>`).join("")
    : "<li>Belum ada skor</li>";
}

renderLeaderboard();
update();
</script>
</body>
</html>
